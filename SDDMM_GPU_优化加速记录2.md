# SDDMM_GPU 优化加速记录2

---

## 总结目前可调整优化的参数

- bsa排序的 `BLOCK_SIZE` 参数
- 行面板的大小 `ROW_PANEL_SIZE` 参数
- 列块的大小 `BLOCK_COL_SIZE` 参数
- 列排序的 `dense_column_segment_threshold` 参数

## 2024-3-14 优化稀疏剩余部分的计算

kernel函数中使用两个线程计算一个元素, 使用shuffle指令进行通信.

Number of results: 126
Number of effective results: 126
Maximum sparsity: 99.99%, minimum sparsity: 95.00%
Accuracy: 100.00%
Average speedup over isratnisa: 2.29, maximum speedup: 3.44
Average speedup over cuSparse: 22.02, maximum speedup: 200.40
Bad results: 0.00%

- Device : NVIDIA GeForce RTX 4090
- Build type : Release
- WMMA_M : 16
- WMMA_N : 16
- WMMA_K : 8
- blockDim_dense : 256, 1, 1
- blockDim_sparse : 512, 1, 1
- matrixA type : f
- matrixB type : f
- matrixC type : f
- matrixA storageOrder : row_major
- matrixB storageOrder : col_major

### M : 20000, N: 20000, sparsity: 98.00%, file: ./../dataset/test/matrix_20000_20000_/matrix_20000_20000_8000000.mtx

| M     | N     | sparsity | K    | isratnisa_sddmm | zcx_sddmm | isratnisa_other | zcx_other | isratnisa | zcx     | cuSparse |
|-------|-------|----------|------|-----------------|-----------|-----------------|-----------|-----------|---------|----------|
| 20000 | 20000 | 98.00%   | 256  | 3.81            | 1.86      | 63.41           | 8023.32   | 67.22     | 8025.18 | 10.03    |NO PASS Error rate : 0.00%
| 20000 | 20000 | 98.00%   | 512  | 7.63            | 3.68      | 70.89           | 7623.23   | 78.52     | 7626.90 | 11.67    |
| 20000 | 20000 | 98.00%   | 1024 | 15.44           | 7.44      | 67.80           | 7689.41   | 83.24     | 7696.85 | 14.99    |
| 20000 | 20000 | 98.00%   | 2048 | 31.94           | 14.80     | 37.40           | 7365.12   | 69.34     | 7379.93 | 37.67    |
| 20000 | 20000 | 98.00%   | 3072 | 47.64           | 22.46     | 37.32           | 7852.24   | 84.97     | 7874.70 | 78.07    |
| 20000 | 20000 | 98.00%   | 4096 | 65.82           | 29.77     | 37.58           | 7876.78   | 103.40    | 7906.55 | 112.83   |

### M : 20000, N: 20000, sparsity: 97.00%, file: ./../dataset/test/matrix_20000_20000_/matrix_20000_20000_12000000.mtx

| M     | N     | sparsity | K    | isratnisa_sddmm | zcx_sddmm | isratnisa_other | zcx_other | isratnisa | zcx     | cuSparse |
|-------|-------|----------|------|-----------------|-----------|-----------------|-----------|-----------|---------|----------|
| 20000 | 20000 | 97.00%   | 256  | 5.58            | 2.75      | 115.06          | 7862.87   | 120.64    | 7865.62 | 10.78    |NO PASS Error rate : 0.00%
| 20000 | 20000 | 97.00%   | 512  | 11.21           | 5.43      | 116.87          | 7537.94   | 128.08    | 7543.37 | 13.30    |
| 20000 | 20000 | 97.00%   | 1024 | 22.50           | 11.00     | 118.40          | 7664.69   | 140.90    | 7675.69 | 18.23    |
| 20000 | 20000 | 97.00%   | 2048 | 44.73           | 21.91     | 115.79          | 8002.51   | 160.52    | 8024.42 | 29.73    |
| 20000 | 20000 | 97.00%   | 3072 | 69.44           | 33.09     | 115.25          | 7555.20   | 184.69    | 7588.29 | 70.86    |
| 20000 | 20000 | 97.00%   | 4096 | 93.30           | 43.94     | 118.04          | 7757.90   | 211.35    | 7801.84 | 139.54   |

### M : 20000, N: 20000, sparsity: 95.00%, file: ./../dataset/test/matrix_20000_20000_/matrix_20000_20000_20000000.mtx

| M     | N     | sparsity | K    | isratnisa_sddmm | zcx_sddmm | isratnisa_other | zcx_other | isratnisa | zcx    | cuSparse |
|-------|-------|----------|------|-----------------|-----------|-----------------|-----------|-----------|--------|----------|
| 20000 | 20000 | 95.00%   | 256  | 9.05            | 4.50      | 206.39          | 475.92    | 215.43    | 480.42 | 12.64    |NO PASS Error rate : 0.00%
| 20000 | 20000 | 95.00%   | 512  | 17.97           | 8.84      | 207.18          | 477.59    | 225.14    | 486.43 | 17.04    |
| 20000 | 20000 | 95.00%   | 1024 | 35.73           | 17.74     | 209.66          | 475.94    | 245.39    | 493.68 | 24.97    |
| 20000 | 20000 | 95.00%   | 2048 | 72.45           | 35.38     | 196.32          | 472.72    | 268.77    | 508.10 | 47.04    |
| 20000 | 20000 | 95.00%   | 3072 | 108.54          | 53.31     | 205.55          | 458.00    | 314.09    | 511.31 | 138.59   |
| 20000 | 20000 | 95.00%   | 4096 | 145.64          | 71.07     | 201.74          | 468.94    | 347.38    | 540.01 | 247.09   |

### M : 20000, N: 20000, sparsity: 96.00%, file: ./../dataset/test/matrix_20000_20000_/matrix_20000_20000_16000000.mtx

| M     | N     | sparsity | K    | isratnisa_sddmm | zcx_sddmm | isratnisa_other | zcx_other | isratnisa | zcx     | cuSparse |
|-------|-------|----------|------|-----------------|-----------|-----------------|-----------|-----------|---------|----------|
| 20000 | 20000 | 96.00%   | 256  | 7.25            | 3.64      | 174.21          | 3839.39   | 181.46    | 3843.02 | 11.91    |NO PASS Error rate : 0.00%
| 20000 | 20000 | 96.00%   | 512  | 14.43           | 7.15      | 174.48          | 3729.96   | 188.91    | 3737.10 | 15.45    |
| 20000 | 20000 | 96.00%   | 1024 | 28.98           | 14.39     | 172.04          | 3746.89   | 201.02    | 3761.28 | 22.46    |
| 20000 | 20000 | 96.00%   | 2048 | 58.58           | 28.66     | 177.09          | 3628.63   | 235.67    | 3657.29 | 58.66    |
| 20000 | 20000 | 96.00%   | 3072 | 87.29           | 43.21     | 171.53          | 3668.99   | 258.82    | 3712.20 | 139.10   |
| 20000 | 20000 | 96.00%   | 4096 | 118.80          | 58.06     | 173.51          | 3829.50   | 292.31    | 3887.56 | 208.77   |

### M : 20000, N: 20000, sparsity: 99.00%, file: ./../dataset/test/matrix_20000_20000_/matrix_20000_20000_4000000.mtx

| M     | N     | sparsity | K    | isratnisa_sddmm | zcx_sddmm | isratnisa_other | zcx_other | isratnisa | zcx     | cuSparse |
|-------|-------|----------|------|-----------------|-----------|-----------------|-----------|-----------|---------|----------|
| 20000 | 20000 | 99.00%   | 256  | 1.19            | 0.97      | 20.03           | 7639.93   | 21.22     | 7640.91 | 9.62     |NO PASS Error rate : 0.00%
| 20000 | 20000 | 99.00%   | 512  | 2.56            | 1.89      | 22.24           | 7322.61   | 24.80     | 7324.51 | 10.22    |
| 20000 | 20000 | 99.00%   | 1024 | 6.17            | 3.83      | 15.92           | 7868.43   | 22.09     | 7872.27 | 11.91    |
| 20000 | 20000 | 99.00%   | 2048 | 14.65           | 7.85      | 15.38           | 7577.96   | 30.03     | 7585.82 | 26.38    |
| 20000 | 20000 | 99.00%   | 3072 | 23.98           | 12.26     | 14.95           | 7421.82   | 38.94     | 7434.08 | 45.06    |
| 20000 | 20000 | 99.00%   | 4096 | 33.65           | 16.76     | 15.44           | 7598.04   | 49.09     | 7614.80 | 61.93    |

### M : 15000, N: 15000, sparsity: 96.00%, file: ./../dataset/test/matrix_15000_15000_/matrix_15000_15000_9000000.mtx

| M     | N     | sparsity | K    | isratnisa_sddmm | zcx_sddmm | isratnisa_other | zcx_other | isratnisa | zcx     | cuSparse |
|-------|-------|----------|------|-----------------|-----------|-----------------|-----------|-----------|---------|----------|
| 15000 | 15000 | 96.00%   | 256  | 4.82            | 2.08      | 89.99           | 2052.00   | 94.81     | 2054.08 | 10.49    |NO PASS Error rate : 0.00%
| 15000 | 15000 | 96.00%   | 512  | 9.74            | 4.04      | 87.28           | 2161.40   | 97.01     | 2165.44 | 12.28    |
| 15000 | 15000 | 96.00%   | 1024 | 19.61           | 8.17      | 88.85           | 2108.98   | 108.46    | 2117.15 | 15.93    |
| 15000 | 15000 | 96.00%   | 2048 | 39.71           | 16.32     | 86.80           | 2008.57   | 126.50    | 2024.89 | 23.56    |
| 15000 | 15000 | 96.00%   | 3072 | 59.61           | 24.56     | 89.74           | 2064.99   | 149.35    | 2089.55 | 32.88    |
| 15000 | 15000 | 96.00%   | 4096 | 80.63           | 32.56     | 89.72           | 2107.27   | 170.35    | 2139.84 | 50.07    |

### M : 15000, N: 15000, sparsity: 97.00%, file: ./../dataset/test/matrix_15000_15000_/matrix_15000_15000_6750000.mtx

| M     | N     | sparsity | K    | isratnisa_sddmm | zcx_sddmm | isratnisa_other | zcx_other | isratnisa | zcx     | cuSparse |
|-------|-------|----------|------|-----------------|-----------|-----------------|-----------|-----------|---------|----------|
| 15000 | 15000 | 97.00%   | 256  | 3.68            | 1.59      | 63.15           | 4551.95   | 66.83     | 4553.54 | 9.63     |NO PASS Error rate : 0.00%
| 15000 | 15000 | 97.00%   | 512  | 7.42            | 3.08      | 62.82           | 4672.07   | 70.25     | 4675.15 | 11.09    |
| 15000 | 15000 | 97.00%   | 1024 | 15.08           | 6.24      | 60.58           | 4598.87   | 75.65     | 4605.10 | 13.77    |
| 15000 | 15000 | 97.00%   | 2048 | 30.91           | 12.48     | 29.10           | 4863.40   | 60.01     | 4875.87 | 20.94    |
| 15000 | 15000 | 97.00%   | 3072 | 44.90           | 18.73     | 28.01           | 4930.74   | 72.91     | 4949.46 | 46.72    |
| 15000 | 15000 | 97.00%   | 4096 | 63.40           | 24.90     | 28.28           | 4631.55   | 91.68     | 4656.45 | 77.86    |

### M : 5000, N: 5000, sparsity: 99.90%, file: ./../dataset/test/matrix_5000_5000_/matrix_5000_5000_25000.mtx

| M    | N    | sparsity | K    | isratnisa_sddmm | zcx_sddmm | isratnisa_other | zcx_other | isratnisa | zcx    | cuSparse |
|------|------|----------|------|-----------------|-----------|-----------------|-----------|-----------|--------|----------|
| 5000 | 5000 | 99.90%   | 256  | 0.17            | 0.05      | 0.21            | 185.36    | 0.38      | 185.41 | 9.53     |
| 5000 | 5000 | 99.90%   | 512  | 0.24            | 0.07      | 0.21            | 178.30    | 0.46      | 178.36 | 10.28    |
| 5000 | 5000 | 99.90%   | 1024 | 0.37            | 0.11      | 0.12            | 190.73    | 0.49      | 190.84 | 10.09    |
| 5000 | 5000 | 99.90%   | 2048 | 0.72            | 0.25      | 0.21            | 167.05    | 0.93      | 167.30 | 9.34     |
| 5000 | 5000 | 99.90%   | 3072 | 1.06            | 0.46      | 0.19            | 173.41    | 1.26      | 173.87 | 9.07     |
| 5000 | 5000 | 99.90%   | 4096 | 1.41            | 0.62      | 0.19            | 193.30    | 1.61      | 193.92 | 9.23     |

### M : 10000, N: 10000, sparsity: 97.00%, file: ./../dataset/test/matrix_10000_10000_/matrix_10000_10000_3000000.mtx

| M     | N     | sparsity | K    | isratnisa_sddmm | zcx_sddmm | isratnisa_other | zcx_other | isratnisa | zcx     | cuSparse |
|-------|-------|----------|------|-----------------|-----------|-----------------|-----------|-----------|---------|----------|
| 10000 | 10000 | 97.00%   | 256  | 1.40            | 0.72      | 17.47           | 2001.11   | 18.87     | 2001.82 | 9.31     |NO PASS Error rate : 0.00%
| 10000 | 10000 | 97.00%   | 512  | 2.75            | 1.39      | 12.34           | 1942.19   | 15.09     | 1943.58 | 9.84     |
| 10000 | 10000 | 97.00%   | 1024 | 5.46            | 2.81      | 14.68           | 1952.67   | 20.14     | 1955.47 | 11.06    |
| 10000 | 10000 | 97.00%   | 2048 | 11.17           | 5.64      | 14.47           | 1984.25   | 25.65     | 1989.90 | 13.37    |
| 10000 | 10000 | 97.00%   | 3072 | 17.50           | 8.55      | 14.03           | 2176.91   | 31.52     | 2185.46 | 16.85    |
| 10000 | 10000 | 97.00%   | 4096 | 24.53           | 11.28     | 13.98           | 1894.21   | 38.51     | 1905.49 | 22.69    |

### M : 10000, N: 10000, sparsity: 99.00%, file: ./../dataset/test/matrix_10000_10000_/matrix_10000_10000_1000000.mtx

| M     | N     | sparsity | K    | isratnisa_sddmm | zcx_sddmm | isratnisa_other | zcx_other | isratnisa | zcx     | cuSparse |
|-------|-------|----------|------|-----------------|-----------|-----------------|-----------|-----------|---------|----------|
| 10000 | 10000 | 99.00%   | 256  | 0.56            | 0.27      | 5.71            | 2144.48   | 6.27      | 2144.75 | 8.90     |
| 10000 | 10000 | 99.00%   | 512  | 0.99            | 0.52      | 2.67            | 1960.20   | 3.66      | 1960.73 | 9.12     |
| 10000 | 10000 | 99.00%   | 1024 | 2.09            | 1.03      | 5.13            | 2059.64   | 7.22      | 2060.66 | 9.33     |
| 10000 | 10000 | 99.00%   | 2048 | 4.45            | 2.27      | 5.15            | 1858.08   | 9.60      | 1860.35 | 10.18    |
| 10000 | 10000 | 99.00%   | 3072 | 6.97            | 3.47      | 5.14            | 1973.23   | 12.10     | 1976.70 | 11.21    |
| 10000 | 10000 | 99.00%   | 4096 | 9.59            | 4.69      | 5.19            | 2011.80   | 14.78     | 2016.49 | 12.29    |

### M : 5000, N: 5000, sparsity: 99.50%, file: ./../dataset/test/matrix_5000_5000_/matrix_5000_5000_125000.mtx

| M    | N    | sparsity | K    | isratnisa_sddmm | zcx_sddmm | isratnisa_other | zcx_other | isratnisa | zcx    | cuSparse |
|------|------|----------|------|-----------------|-----------|-----------------|-----------|-----------|--------|----------|
| 5000 | 5000 | 99.50%   | 256  | 0.24            | 0.09      | 0.76            | 468.73    | 1.00      | 468.82 | 9.96     |
| 5000 | 5000 | 99.50%   | 512  | 0.40            | 0.14      | 0.77            | 482.70    | 1.18      | 482.84 | 10.01    |
| 5000 | 5000 | 99.50%   | 1024 | 0.70            | 0.26      | 0.36            | 418.53    | 1.06      | 418.79 | 9.85     |
| 5000 | 5000 | 99.50%   | 2048 | 1.41            | 0.48      | 0.76            | 456.84    | 2.17      | 457.32 | 9.01     |
| 5000 | 5000 | 99.50%   | 3072 | 2.09            | 0.80      | 0.70            | 491.39    | 2.79      | 492.19 | 9.10     |
| 5000 | 5000 | 99.50%   | 4096 | 2.77            | 1.01      | 0.70            | 511.22    | 3.47      | 512.23 | 9.42     |

### M : 15000, N: 15000, sparsity: 98.00%, file: ./../dataset/test/matrix_15000_15000_/matrix_15000_15000_4500000.mtx

| M     | N     | sparsity | K    | isratnisa_sddmm | zcx_sddmm | isratnisa_other | zcx_other | isratnisa | zcx     | cuSparse |
|-------|-------|----------|------|-----------------|-----------|-----------------|-----------|-----------|---------|----------|
| 15000 | 15000 | 98.00%   | 256  | 1.46            | 1.10      | 35.89           | 4580.51   | 37.34     | 4581.61 | 9.57     |NO PASS Error rate : 0.00%
| 15000 | 15000 | 98.00%   | 512  | 3.08            | 2.10      | 19.79           | 4737.24   | 22.87     | 4739.33 | 10.50    |
| 15000 | 15000 | 98.00%   | 1024 | 7.02            | 4.27      | 19.28           | 4855.76   | 26.30     | 4860.03 | 12.21    |
| 15000 | 15000 | 98.00%   | 2048 | 16.88           | 8.48      | 18.18           | 4385.58   | 35.06     | 4394.06 | 19.00    |
| 15000 | 15000 | 98.00%   | 3072 | 27.37           | 12.97     | 17.63           | 4635.90   | 45.00     | 4648.87 | 30.10    |
| 15000 | 15000 | 98.00%   | 4096 | 37.27           | 17.04     | 18.44           | 4816.02   | 55.72     | 4833.06 | 59.75    |

### M : 10000, N: 10000, sparsity: 98.00%, file: ./../dataset/test/matrix_10000_10000_/matrix_10000_10000_2000000.mtx

| M     | N     | sparsity | K    | isratnisa_sddmm | zcx_sddmm | isratnisa_other | zcx_other | isratnisa | zcx     | cuSparse |
|-------|-------|----------|------|-----------------|-----------|-----------------|-----------|-----------|---------|----------|
| 10000 | 10000 | 98.00%   | 256  | 0.92            | 0.53      | 11.68           | 2216.41   | 12.60     | 2216.93 | 9.73     |NO PASS Error rate : 0.00%
| 10000 | 10000 | 98.00%   | 512  | 1.86            | 1.00      | 9.22            | 2061.56   | 11.09     | 2062.56 | 9.63     |
| 10000 | 10000 | 98.00%   | 1024 | 3.78            | 1.94      | 9.19            | 2058.14   | 12.96     | 2060.07 | 10.90    |
| 10000 | 10000 | 98.00%   | 2048 | 7.90            | 3.88      | 9.17            | 2104.14   | 17.07     | 2108.01 | 11.77    |
| 10000 | 10000 | 98.00%   | 3072 | 12.45           | 5.97      | 9.08            | 2109.19   | 21.53     | 2115.16 | 14.19    |
| 10000 | 10000 | 98.00%   | 4096 | 17.29           | 7.94      | 9.12            | 2214.49   | 26.42     | 2222.43 | 24.24    |

### M : 15000, N: 15000, sparsity: 95.00%, file: ./../dataset/test/matrix_15000_15000_/matrix_15000_15000_11250000.mtx

| M     | N     | sparsity | K    | isratnisa_sddmm | zcx_sddmm | isratnisa_other | zcx_other | isratnisa | zcx    | cuSparse |
|-------|-------|----------|------|-----------------|-----------|-----------------|-----------|-----------|--------|----------|
| 15000 | 15000 | 95.00%   | 256  | 5.95            | 2.55      | 113.24          | 290.36    | 119.19    | 292.91 | 10.71    |NO PASS Error rate : 0.00%
| 15000 | 15000 | 95.00%   | 512  | 11.96           | 4.98      | 112.19          | 293.94    | 124.14    | 298.92 | 12.95    |
| 15000 | 15000 | 95.00%   | 1024 | 24.08           | 10.03     | 112.35          | 290.59    | 136.43    | 300.62 | 17.47    |
| 15000 | 15000 | 95.00%   | 2048 | 47.09           | 20.01     | 109.33          | 286.39    | 156.42    | 306.40 | 27.84    |
| 15000 | 15000 | 95.00%   | 3072 | 73.46           | 30.12     | 116.49          | 293.65    | 189.95    | 323.77 | 56.53    |
| 15000 | 15000 | 95.00%   | 4096 | 98.46           | 40.08     | 110.27          | 296.26    | 208.72    | 336.34 | 92.51    |

### M : 5000, N: 5000, sparsity: 99.99%, file: ./../dataset/test/matrix_5000_5000_/matrix_5000_5000_2500.mtx

| M    | N    | sparsity | K    | isratnisa_sddmm | zcx_sddmm | isratnisa_other | zcx_other | isratnisa | zcx   | cuSparse |
|------|------|----------|------|-----------------|-----------|-----------------|-----------|-----------|-------|----------|
| 5000 | 5000 | 99.99%   | 256  | 0.14            | 0.07      | 0.04            | 38.26     | 0.18      | 38.33 | 10.00    |
| 5000 | 5000 | 99.99%   | 512  | 0.19            | 0.07      | 0.04            | 32.46     | 0.23      | 32.52 | 10.01    |
| 5000 | 5000 | 99.99%   | 1024 | 0.30            | 0.11      | 0.03            | 28.22     | 0.33      | 28.33 | 9.33     |
| 5000 | 5000 | 99.99%   | 2048 | 0.57            | 0.22      | 0.04            | 28.54     | 0.61      | 28.76 | 8.98     |
| 5000 | 5000 | 99.99%   | 3072 | 0.82            | 0.31      | 0.03            | 28.74     | 0.85      | 29.05 | 9.06     |
| 5000 | 5000 | 99.99%   | 4096 | 1.06            | 0.42      | 0.03            | 28.54     | 1.10      | 28.96 | 9.02     |

### M : 5000, N: 5000, sparsity: 99.80%, file: ./../dataset/test/matrix_5000_5000_/matrix_5000_5000_50000.mtx

| M    | N    | sparsity | K    | isratnisa_sddmm | zcx_sddmm | isratnisa_other | zcx_other | isratnisa | zcx    | cuSparse |
|------|------|----------|------|-----------------|-----------|-----------------|-----------|-----------|--------|----------|
| 5000 | 5000 | 99.80%   | 256  | 0.17            | 0.05      | 0.35            | 410.55    | 0.52      | 410.60 | 10.02    |
| 5000 | 5000 | 99.80%   | 512  | 0.27            | 0.08      | 0.34            | 352.38    | 0.61      | 352.46 | 9.72     |
| 5000 | 5000 | 99.80%   | 1024 | 0.45            | 0.14      | 0.18            | 405.09    | 0.63      | 405.22 | 9.45     |
| 5000 | 5000 | 99.80%   | 2048 | 0.89            | 0.27      | 0.33            | 413.31    | 1.23      | 413.59 | 9.01     |
| 5000 | 5000 | 99.80%   | 3072 | 1.36            | 0.48      | 0.32            | 412.90    | 1.68      | 413.38 | 9.19     |
| 5000 | 5000 | 99.80%   | 4096 | 1.75            | 0.64      | 0.33            | 368.89    | 2.08      | 369.53 | 9.31     |

### M : 5000, N: 5000, sparsity: 99.60%, file: ./../dataset/test/matrix_5000_5000_/matrix_5000_5000_100000.mtx

| M    | N    | sparsity | K    | isratnisa_sddmm | zcx_sddmm | isratnisa_other | zcx_other | isratnisa | zcx    | cuSparse |
|------|------|----------|------|-----------------|-----------|-----------------|-----------|-----------|--------|----------|
| 5000 | 5000 | 99.60%   | 256  | 0.23            | 0.07      | 0.68            | 510.60    | 0.90      | 510.67 | 10.00    |
| 5000 | 5000 | 99.60%   | 512  | 0.35            | 0.11      | 0.64            | 462.76    | 0.99      | 462.86 | 9.83     |
| 5000 | 5000 | 99.60%   | 1024 | 0.63            | 0.21      | 0.30            | 488.89    | 0.92      | 489.10 | 9.08     |
| 5000 | 5000 | 99.60%   | 2048 | 1.24            | 0.40      | 0.62            | 456.78    | 1.86      | 457.19 | 9.09     |
| 5000 | 5000 | 99.60%   | 3072 | 1.86            | 0.67      | 0.57            | 424.67    | 2.42      | 425.34 | 9.09     |
| 5000 | 5000 | 99.60%   | 4096 | 2.43            | 0.92      | 0.58            | 484.67    | 3.01      | 485.59 | 9.34     |

### M : 5000, N: 5000, sparsity: 99.70%, file: ./../dataset/test/matrix_5000_5000_/matrix_5000_5000_75000.mtx

| M    | N    | sparsity | K    | isratnisa_sddmm | zcx_sddmm | isratnisa_other | zcx_other | isratnisa | zcx    | cuSparse |
|------|------|----------|------|-----------------|-----------|-----------------|-----------|-----------|--------|----------|
| 5000 | 5000 | 99.70%   | 256  | 0.20            | 0.06      | 0.46            | 462.99    | 0.66      | 463.05 | 9.58     |
| 5000 | 5000 | 99.70%   | 512  | 0.31            | 0.09      | 0.47            | 469.56    | 0.78      | 469.65 | 9.69     |
| 5000 | 5000 | 99.70%   | 1024 | 0.53            | 0.16      | 0.23            | 445.79    | 0.76      | 445.95 | 9.34     |
| 5000 | 5000 | 99.70%   | 2048 | 1.08            | 0.34      | 0.49            | 431.23    | 1.57      | 431.57 | 9.07     |
| 5000 | 5000 | 99.70%   | 3072 | 1.59            | 0.60      | 0.46            | 437.11    | 2.05      | 437.71 | 9.28     |
| 5000 | 5000 | 99.70%   | 4096 | 2.10            | 0.81      | 0.45            | 453.39    | 2.55      | 454.20 | 9.29     |

### M : 10000, N: 10000, sparsity: 96.00%, file: ./../dataset/test/matrix_10000_10000_/matrix_10000_10000_4000000.mtx

| M     | N     | sparsity | K    | isratnisa_sddmm | zcx_sddmm | isratnisa_other | zcx_other | isratnisa | zcx    | cuSparse |
|-------|-------|----------|------|-----------------|-----------|-----------------|-----------|-----------|--------|----------|
| 10000 | 10000 | 96.00%   | 256  | 1.73            | 0.97      | 22.02           | 278.80    | 23.75     | 279.77 | 9.64     |NO PASS Error rate : 0.00%
| 10000 | 10000 | 96.00%   | 512  | 3.61            | 1.85      | 19.69           | 298.17    | 23.30     | 300.03 | 10.28    |
| 10000 | 10000 | 96.00%   | 1024 | 7.16            | 3.67      | 22.52           | 284.13    | 29.69     | 287.79 | 11.95    |
| 10000 | 10000 | 96.00%   | 2048 | 14.37           | 7.39      | 16.00           | 284.89    | 30.37     | 292.28 | 14.99    |
| 10000 | 10000 | 96.00%   | 3072 | 22.18           | 11.18     | 15.72           | 294.70    | 37.90     | 305.88 | 19.41    |
| 10000 | 10000 | 96.00%   | 4096 | 31.17           | 14.72     | 15.87           | 266.04    | 47.04     | 280.76 | 23.64    |

### M : 10000, N: 10000, sparsity: 95.00%, file: ./../dataset/test/matrix_10000_10000_/matrix_10000_10000_5000000.mtx

| M     | N     | sparsity | K    | isratnisa_sddmm | zcx_sddmm | isratnisa_other | zcx_other | isratnisa | zcx    | cuSparse |
|-------|-------|----------|------|-----------------|-----------|-----------------|-----------|-----------|--------|----------|
| 10000 | 10000 | 95.00%   | 256  | 2.17            | 1.19      | 42.01           | 136.69    | 44.18     | 137.88 | 9.79     |NO PASS Error rate : 0.00%
| 10000 | 10000 | 95.00%   | 512  | 4.53            | 2.39      | 45.43           | 142.12    | 49.96     | 144.51 | 10.72    |
| 10000 | 10000 | 95.00%   | 1024 | 9.10            | 4.53      | 44.00           | 131.62    | 53.10     | 136.15 | 12.67    |
| 10000 | 10000 | 95.00%   | 2048 | 18.09           | 9.05      | 21.31           | 129.68    | 39.39     | 138.73 | 16.84    |
| 10000 | 10000 | 95.00%   | 3072 | 27.59           | 13.70     | 19.83           | 129.63    | 47.42     | 143.33 | 21.45    |
| 10000 | 10000 | 95.00%   | 4096 | 36.72           | 18.14     | 20.51           | 134.58    | 57.23     | 152.71 | 26.13    |

### M : 15000, N: 15000, sparsity: 99.00%, file: ./../dataset/test/matrix_15000_15000_/matrix_15000_15000_2250000.mtx

| M     | N     | sparsity | K    | isratnisa_sddmm | zcx_sddmm | isratnisa_other | zcx_other | isratnisa | zcx     | cuSparse |
|-------|-------|----------|------|-----------------|-----------|-----------------|-----------|-----------|---------|----------|
| 15000 | 15000 | 99.00%   | 256  | 0.78            | 0.55      | 9.48            | 4569.99   | 10.26     | 4570.54 | 9.70     |NO PASS Error rate : 0.00%
| 15000 | 15000 | 99.00%   | 512  | 1.72            | 1.06      | 6.35            | 4700.80   | 8.07      | 4701.86 | 9.30     |
| 15000 | 15000 | 99.00%   | 1024 | 4.12            | 2.21      | 10.23           | 4355.33   | 14.35     | 4357.54 | 10.26    |
| 15000 | 15000 | 99.00%   | 2048 | 9.62            | 4.49      | 9.97            | 4365.49   | 19.59     | 4369.98 | 13.92    |
| 15000 | 15000 | 99.00%   | 3072 | 14.72           | 7.02      | 10.30           | 3956.01   | 25.02     | 3963.02 | 20.51    |
| 15000 | 15000 | 99.00%   | 4096 | 20.56           | 9.35      | 10.01           | 4272.64   | 30.57     | 4281.99 | 33.48    |

---

## 尝试修改dense_column_segment_threshold_的值进行比较

测试阈值(dense_column_segment_threshold_) = 2, 3, 4, 5, 6, 7

### dense_column_segment_threshold_ = 2

Number of results: 126
Number of effective results: 126
Maximum sparsity: 99.99%, minimum sparsity: 95.00%
Accuracy: 100.00%
Average speedup over isratnisa: 2.78, maximum speedup: 5.75
Average speedup over cuSparse: 30.52, maximum speedup: 269.25
Bad results: 0.00%

---

### dense_column_segment_threshold_ = 3

Number of results: 126
Number of effective results: 126
Maximum sparsity: 99.99%, minimum sparsity: 95.00%
Accuracy: 100.00%
Average speedup over isratnisa: 2.96, maximum speedup: 6.07
Average speedup over cuSparse: 34.18, maximum speedup: 277.50
Bad results: 0.00%

---

### dense_column_segment_threshold_ = 4

Number of results: 126
Number of effective results: 126
Maximum sparsity: 99.99%, minimum sparsity: 95.00%
Accuracy: 100.00%
Average speedup over isratnisa: 2.93, maximum speedup: 5.75
Average speedup over cuSparse: 32.17, maximum speedup: 268.00
Bad results: 0.00%

---

### dense_column_segment_threshold_ = 5

Number of results: 126
Number of effective results: 126
Maximum sparsity: 99.99%, minimum sparsity: 95.00%
Accuracy: 100.00%
Average speedup over isratnisa: 2.93, maximum speedup: 6.00
Average speedup over cuSparse: 32.72, maximum speedup: 276.00
Bad results: 0.00%

---

### dense_column_segment_threshold_ = 6

Number of results: 126
Number of effective results: 126
Maximum sparsity: 99.99%, minimum sparsity: 95.00%
Accuracy: 100.00%
Average speedup over isratnisa: 2.94, maximum speedup: 6.00
Average speedup over cuSparse: 31.55, maximum speedup: 259.25
Bad results: 0.00%

---

### dense_column_segment_threshold_ = 7

---

## 测试isratnisa论文数据集

### M  34546, N: 34546, sparsity: 99.96%, file: ./dataset_of_isratnisa_paper_results/dataset/cit-HepPh.txt

| M     | N     | sparsity | K   | isratnisa_gflops | cuSparse_gflops | zcx_gflops | isratnisa_sddmm | cuSparse_sddmm | zcx_sddmm | isratnisa_other | zcx_other | isratnisa | zcx     |
|-------|-------|----------|-----|------------------|-----------------|------------|-----------------|----------------|-----------|-----------------|-----------|-----------|---------|
| 34546 | 34546 | 99.96%   | 32  |                  | 2.65            | 325.29     |                 | 10.20          | 0.08      |                 | 2589.57   |           | 2589.65 |
| 34546 | 34546 | 99.96%   | 128 |                  | 10.67           | 878.29     |                 | 10.11          | 0.12      |                 | 2832.69   |           | 2832.82 |
| 34546 | 34546 | 99.96%   | 512 |                  | 44.67           | 1013.41    |                 | 9.66           | 0.43      |                 | 2754.92   |           | 2755.35 |

### M , N: , sparsity: , file: ./dataset_of_isratnisa_paper_results/dataset/com-amazon.ungraph.txt

| M | N | sparsity | K   | isratnisa_gflops | cuSparse_gflops | zcx_gflops | isratnisa_sddmm | cuSparse_sddmm | zcx_sddmm | isratnisa_other | zcx_other | isratnisa | zcx |
|---|---|----------|-----|------------------|-----------------|------------|-----------------|----------------|-----------|-----------------|-----------|-----------|-----|
|   |   |          | 32  |                  |                 |            |                 |                |           |                 |           |           |     |
|   |   |          | 128 |                  |                 |            |                 |                |           |                 |           |           |     |
|   |   |          | 512 |                  |                 |            |                 |                |           |                 |           |           |     |

### M  1005, N: 1005, sparsity: 97.47%, file: ./dataset_of_isratnisa_paper_results/dataset/email-Eu-core.txt

| M    | N    | sparsity | K   | isratnisa_gflops | cuSparse_gflops | zcx_gflops | isratnisa_sddmm | cuSparse_sddmm | zcx_sddmm | isratnisa_other | zcx_other | isratnisa | zcx   |
|------|------|----------|-----|------------------|-----------------|------------|-----------------|----------------|-----------|-----------------|-----------|-----------|-------|
| 1005 | 1005 | 97.47%   | 32  |                  | 0.15            | 53.27      |                 | 10.74          | 0.03      |                 | 17.38     |           | 17.42 |
| 1005 | 1005 | 97.47%   | 128 |                  | 0.61            | 168.23     |                 | 10.70          | 0.04      |                 | 17.25     |           | 17.29 |
| 1005 | 1005 | 97.47%   | 512 |                  | 2.44            | 340.95     |                 | 10.71          | 0.08      |                 | 17.52     |           | 17.60 |

### M  4039, N: 4039, sparsity: 99.46%, file: ./dataset_of_isratnisa_paper_results/dataset/facebook_combined_adj.mmio

| M    | N    | sparsity | K   | isratnisa_gflops | cuSparse_gflops | zcx_gflops | isratnisa_sddmm | cuSparse_sddmm | zcx_sddmm | isratnisa_other | zcx_other | isratnisa | zcx   |
|------|------|----------|-----|------------------|-----------------|------------|-----------------|----------------|-----------|-----------------|-----------|-----------|-------|
| 4039 | 4039 | 99.46%   | 32  | 48.18            | 0.53            | 102.12     | 0.12            | 10.57          | 0.06      | 0.51            | 33.40     | 0.62      | 33.45 |
| 4039 | 4039 | 99.46%   | 128 | 103.61           | 2.10            | 450.17     | 0.22            | 10.74          | 0.05      | 0.53            | 33.24     | 0.74      | 33.30 |
| 4039 | 4039 | 99.46%   | 512 | 149.98           | 8.67            | 840.32     | 0.60            | 10.43          | 0.11      | 0.54            | 33.04     | 1.14      | 33.15 |

### M , N: , sparsity: , file: ./dataset_of_isratnisa_paper_results/dataset/loc-gowalla_edges.txt

| M | N | sparsity | K   | isratnisa_gflops | cuSparse_gflops | zcx_gflops | isratnisa_sddmm | cuSparse_sddmm | zcx_sddmm | isratnisa_other | zcx_other | isratnisa | zcx |
|---|---|----------|-----|------------------|-----------------|------------|-----------------|----------------|-----------|-----------------|-----------|-----------|-----|
|   |   |          | 32  |                  |                 |            |                 |                |           |                 |           |           |     |
|   |   |          | 128 |                  |                 |            |                 |                |           |                 |           |           |     |
|   |   |          | 512 |                  |                 |            |                 |                |           |                 |           |           |     |

### file: web-BerkStan.txt

| M | N | sparsity | K   | isratnisa_gflops | cuSparse_gflops | zcx_gflops | isratnisa_sddmm | cuSparse_sddmm | zcx_sddmm | isratnisa_other | zcx_other | isratnisa | zcx |
|---|---|----------|-----|------------------|-----------------|------------|-----------------|----------------|-----------|-----------------|-----------|-----------|-----|
|   |   |          | 32  |                  |                 |            |                 |                |           |                 |           |           |     |
|   |   |          | 128 |                  |                 |            |                 |                |           |                 |           |           |     |
|   |   |          | 512 |                  |                 |            |                 |                |           |                 |           |           |     |

### file: web-Google.txt

| M | N | sparsity | K   | isratnisa_gflops | cuSparse_gflops | zcx_gflops | isratnisa_sddmm | cuSparse_sddmm | zcx_sddmm | isratnisa_other | zcx_other | isratnisa | zcx |
|---|---|----------|-----|------------------|-----------------|------------|-----------------|----------------|-----------|-----------------|-----------|-----------|-----|
|   |   |          | 32  |                  |                 |            |                 |                |           |                 |           |           |     |
|   |   |          | 128 |                  |                 |            |                 |                |           |                 |           |           |     |
|   |   |          | 512 |                  |                 |            |                 |                |           |                 |           |           |     |

### M , N: , sparsity: , file: ./dataset_of_isratnisa_paper_results/dataset/web-NotreDame.txt

| M | N | sparsity | K   | isratnisa_gflops | cuSparse_gflops | zcx_gflops | isratnisa_sddmm | cuSparse_sddmm | zcx_sddmm | isratnisa_other | zcx_other | isratnisa | zcx |
|---|---|----------|-----|------------------|-----------------|------------|-----------------|----------------|-----------|-----------------|-----------|-----------|-----|
|   |   |          | 32  |                  |                 |            |                 |                |           |                 |           |           |     |
|   |   |          | 128 |                  |                 |            |                 |                |           |                 |           |           |     |
|   |   |          | 512 |                  |                 |            |                 |                |           |                 |           |           |     |

---

## 研究dense_column_segment_threshold_的值对性能的影响

Tensor Core TF32(稠密)的峰值性能: 330 TFLOPS
CUDA Core FP32的峰值性能: 82.58 TFLOPS

使用Tensor Core TF32(稠密)来计算SDDMM时, 不是所有计算都是有效计算. 使用CUDA Core FP32来计算SDDMM时, 所有计算都是有效计算.
矩阵块约密集, 使用Tensor Core TF32(稠密)来计算SDDMM时, 计算效率高. 矩阵块约稀疏, 使用CUDA Core FP32来计算SDDMM时, 计算效率高.

选择使用Tensor Core TF32(稠密) 和 CUDA Core FP32 的阈值, 使得计算效率最高.

理论阈值 = 82.58 / 330 ≈ 0.25. 相当于矩阵块中每一列至少要有4个非零元素.

然而, 还有一个K的因素, 如果K越大, Tensor Core的效率越高, 但是有效计算量会随着K的增大而减小.

实验画图, 寻找最佳的dense_column_segment_threshold_的值.

实验设置:

同一个矩阵大小, 同一个K值, 不同的稀疏度(具有平均的稀疏结构).

- 全部使用CUDA Core来计算SDDMM. 记录GFLOPS.
- 全部使用Tensor Core TF32(稠密)来计算SDDMM. 记录GFLOPS.

进行实验, 画图.

- x轴: 稀疏度(0.1~1.0)
- y轴: GFLOPS

两条曲线的交叉点就是就是稀疏度阈值.

根据这个稀疏度阈值再进行实验:

同一个矩阵大小, 同一个稀疏度(具有平均的稀疏结构), 不同的K值.

- 全部使用CUDA Core来计算SDDMM. 记录GFLOPS.
- 全部使用Tensor Core TF32(稠密)来计算SDDMM. 记录GFLOPS.

进行实验, 画图.

- x轴: K
- y轴: GFLOPS

两条曲线的交叉点就是就是

> 实验建议: 每组测试 运行多次，取平均值